require(['jquery'],function($){(function($){'use strict';function send(action,actionData){actionData=actionData||{};var url='/rest/V1/tracking/log';var payload={action:action,action_data:JSON.stringify(actionData),page:window.location.pathname+window.location.search,timestamp:now(),website:$('.page-header').data('tracking-website')||'UAE'};try{if(navigator.sendBeacon){var blob=new Blob([JSON.stringify(payload)],{type:'application/json'});if(navigator.sendBeacon(url,blob))return;}}catch(e){console.error('sendBeacon failed:',e);}
$.ajax({url:url,method:'POST',contentType:'application/json',data:JSON.stringify(payload),xhrFields:{withCredentials:true}});}
function now(){return new Date().toISOString().slice(0,19).replace('T',' ');}
function getPageContext(){var body=$('body');var data={};if(body.hasClass('catalog-category-view')){data.page="Category";data.pageinfo=$('.page-title span').text().trim()||$("meta[name='title']").attr("content");}else if(body.hasClass('catalog-product-view')){data.page="Product";data.pageinfo=$('.page-title span').text().trim();data.sku=$('.product.attribute.sku').html().trim();}else if(body.hasClass('cms-index-index')){data.page="Home Page";data.pageinfo=$("meta[name='title']").attr("content");}else if(body.hasClass('wordpress-post-view')){data.page="WordPress Page";data.pageinfo=$('.page-title span').first().text().trim();}else if(body.hasClass('checkout-cart-index')){data.page="Cart Page";}else if(body.hasClass('checkout-index-index')){data.page="Checkout Page";}else if(body.hasClass('checkout-onepage-success')){data.page="Success Page";}
return data;}
$(document).ready(function(){send('page_view',getPageContext());});$(document).on('click','[data-track-action]',function(){send($(this).data('track-action')||'click');});$(document).on('click','.tocart',function(){var form=$(this).closest('form,.product-info-main');var qty=parseFloat(form.find('.input-text.qty').val())||1;var sku=$('.product-info-main').find('.product.attribute.sku').html().trim()||'';send('product_add_to_cart',{product_code:sku,qty:qty});});$(document).on('click','.addtoproject',function(){var form=$('form,.product-info-main');var qty=parseFloat(form.find('.input-text.qty').val())||1;var sku=$('.product-info-main').find('.product.attribute.sku').html().trim()||'';send('product_add_to_project',{product_code:sku,qty:qty});});$(document).on('click','.action.delete',function(){send('product_remove_from_cart');});$(document).on('click','a[href]',function(){const $a=$(this);const text=$a.text().trim()||$a.find('img').attr('alt')?.trim()||$a.attr('href');send('link_click',{link_info:text,href:$a.attr('href')});});$(document).on('change','.filter-options-content input[type="checkbox"]',function(){var $checkbox=$(this);var $label=$checkbox.closest('li').find('label .label').text().trim();var isChecked=$checkbox.is(':checked');send('filter_click',{filter_group:$checkbox.closest('.filter-options').find('.filter-options-title strong').text().trim()||'Unknown',filter_label:$label,filter_value:$checkbox.val(),filter_status:isChecked?'selected':'deselected'});});$(document).on('submit','form',function(){var $form=$(this);if($form.is('[data-mage-init*="mage/new-customer-account"]')){send('customer_account_creation');}else if($form.is('#login-form')){send('customer_login');}else if($form.is('#newsletter-validate-detail')){var subscription_email=$form.find('input[name="email"]').val();send('newsletter_subscription',{subscriber_email:subscription_email});}else if($form.is('#appointment-form')){send('book_your_appointment');}else if($form.is('#wpforms-form-37144')){send('make_an_enquiry_submission');}else if($form.is('#search_mini_form')){var query=$form.find('#search').val();send('search_keyword',{keyword:query});}});$(document).on('tracking:checkout',function(e,detail){if(detail&&detail.action){send(detail.action,detail.data);}});})(jQuery);});